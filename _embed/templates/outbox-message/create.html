<script src="/static/autolinker.min.js"></script>
<script src="/static/nebula/uploader._hs" type="text/hyperscript"></script>

<script type="text/hyperscript">
	def preview()
		log #file-upload
		log #file-upload.files
		set #file-preview.innerHTML to ""
		repeat for file in #file-upload.files
			append '<div><img src="' + URL.createObjectURL(file) + '"></div>' to #file-preview.innerHTML
		end
	end
</script>

<form id="outbox-message" hx-post="/@me/outbox-add?templateId=outbox-message" hx-encoding="multipart/form-data">
	<div style="margin-bottom:10px;">
		<textarea 
			name="document.summary" 
			placeholder="Share something interesting..." 
			autocomplete="false" 
			autofocus="true"
			script="on keypress debounced at 200ms log Autolinker.link(my value)"
			class="block"></textarea>
	</div>

	<div id="file-preview"></div>
	<input 
		script="on change preview()" 
		id="file-upload" 
		type="file" 
		accept="image"
		name="file" 
		class="hide">

	<div class="text-sm">
		<button type="submit" class="primary htmx-request-hide">New Post</button>
		<button type="button" class="primary htmx-request-show" disabled>Posting...</button>
		&nbsp;
		<label for="file-upload" class="link text-lg" role="button">{{icon "image"}}</label>
	</div>
</form>

<style>
	#file-preview {
		display:flex;
		flex-direction:row;
		flex-wrap:wrap;
	}

	#file-preview > div {
		display:block;
		width:20%;
		aspect-ratio: 1;
		padding:0px 10px 10px 0px;
	}

	#file-preview > div > img {
		padding:2px 2px 10px 2px;
		border:solid 1px var(--gray20);
		border-radius:5px;
		width: 100%;
		height:100%;
		object-fit: cover;
		border-radius:5px;
	}

</style>