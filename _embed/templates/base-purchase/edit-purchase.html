<div class="page">

	<div class="margin-bottom">
		<a href="/{{.StreamID}}">&larr; Back to View </a>
	</div>

	<div class="flex-row margin-bottom-xl">
		<div>
			{{- $iconURL := .IconURL -}}
			{{- if ne "" $iconURL -}}
				<img src="{{$iconURL}}" class="rounded square width-96">
			{{- else -}}
				<div class="rounded square width-96"></div>
			{{- end -}}
		</div>
		<div class="flex-grow">
			<h1 class="margin-none">{{.Label}}</h1>
			<div class="text-gray">
				Setting Up Purchase Options
			</div>
		</div>
	</div>

	{{- $merchantAccounts := .MerchantAccounts.Slice -}}

	{{- if eq 0 $merchantAccounts.Length -}}

		<h1 class="text-xl bold">Set Up Purchase Options for this Item</h1>
		<div class="margin-bottom-lg md:width-60%">
			The first step in collecting payments is to connect to one of the supported payment procesors below.
			After you've entered your merchant account information, you'll be able to use the product plan(s) from your merchant account to 
			charge for access to this item.
			<a href="https://emissary.dev/products" class="nowrap" target="_blank">Learn More {{icon "new-window"}}</a>
		</div>

		<div class="md:flex-row margin-bottom md:text-sm">
			{{- $connections := .AvailableMerchantAccounts -}}

			{{- range $index, $connection := $connections -}}
				<a href="/@me/oauth/connect/{{$connection.Value | lowerCase }}" class="text-nocolor card padding margin-bottom hover-outline flex-row md:flex-column md:width-25%">
					<div class="align-center margin-bottom flex-grow">
						<img src="{{$connection.Icon}}" class="width-64 md:height-100%">
					</div>
					<div class="text-gray">{{$connection.Description}}</div>
				</a>
			{{- end -}}
			<div hx-get="/@me/settings/merchantAccount-edit-stripe" class="clickable card padding margin-bottom hover-outline flex-row md:flex-column md:width-25%" role="button">
				<div class="align-center margin-bottom flex-grow">
					<img src="/.templates/user-inbox/resources/stripe.svg" class="width-128 md:height-100%">
				</div>
				<div class="text-gray">Stripe is a sophisticated payment platform for developers and techies.</div>
			</div>
		</div>


	{{- else -}}

		<details>
			<summary class="clickable flex-row flex-align-center">
				<h1 class="text-xl bold margin-none margin-right inline" style="line-height:1em;">
					Merchant Account
				</h1>
				<span class="text-sm" style="color:white; background:var(--green70); border-radius:8px; padding:8px 16px;"> &check; Connected</span>
			</summary>

			<div class="table margin-top">
				{{- range  $index, $merchantAccount := $merchantAccounts -}}
					{{- $type := lowerCase $merchantAccount.Type -}}
					<div role="button" class="flex-row turboclick">
						<div hx-get="/@me/settings/merchantAccount-edit-{{$type}}?merchantAccountId={{$merchantAccount.ID}}" class="flex-row flex-grow">
							<div>{{- icon $type -}}</div>
							<div class="flex-grow">{{$merchantAccount.Name}}</div>
						</div>
					</div>
				{{- end -}}
				<div hx-get="/@me/settings/merchantAccount-add" role="button" class="flex-row link turboclick">
					<div>{{- icon "add" -}}</div>
					<div>Connect Another</div>
				</div>
			</div>
		</details>

		<h1 class="margin-top-lg text-xl bold">Products &amp; Subscriptions</h1>

		<div id="choose-products" hx-get="/{{.StreamID}}/choose-products" hx-trigger="load" hx-target="#choose-products" hx-swap="innerHTML" hx-push-url="false">
			One moment please, loading...
		</div>

	{{- end -}}

	<div class="margin-vertical-xl"></div>

	<div hx-get="/{{.StreamID}}/edit-purchase" hx-trigger="refreshPage from:window" hx-push-url="false"></div>
</div>