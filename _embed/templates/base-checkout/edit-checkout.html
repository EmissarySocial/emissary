<div class="page">

	<div class="margin-bottom-lg">
		<a href="/@{{.AttributedTo.UserID.Hex}}">{{.AttributedTo.Name}} </a> &middot;
		<a href="/{{.StreamID}}"> {{.Label}}</a>
	</div>

	<div class="flex-row margin-bottom-xl">
		<div>
			{{- $iconURL := .IconURL -}}
			{{- if ne "" $iconURL -}}
				<img src="{{$iconURL}}" class="rounded square width-96">
			{{- else -}}
				<div class="rounded square width-96"></div>
			{{- end -}}
		</div>
		<div class="flex-grow">
			<h1 class="margin-none">{{.Label}}</h1>
			<div class="text-gray">
				Setting Up Purchase Options
			</div>
		</div>
	</div>

	{{- $merchantAccounts := .MerchantAccounts.Slice -}}

	{{- if eq 0 $merchantAccounts.Length -}}

		<h1 class="text-xl bold">
			1. Merchant Account
		</h1>
		
		<div class="margin-bottom-lg md:width-60%">
			To sell access to this album online, you must first sign up and connect to one of the supported payment procesors below.
			<br><br>
			After you've entered your merchant account information, you'll be able to use the product plan(s) from your merchant account to 
			charge for access to this item.
			<a href="https://emissary.dev/products" class="nowrap" target="_blank">Learn More {{icon "new-window"}}</a>
		</div>

		<div class="md:flex-row margin-bottom md:text-sm">
			{{- $connections := .AvailableMerchantAccounts -}}

			{{- range $index, $connection := $connections -}}
				<a href="/@me/oauth/connect/{{$connection.Value | lowerCase }}" class="text-nocolor card padding margin-bottom hover-outline flex-row md:flex-column md:width-25%">
					<div class="align-center margin-bottom flex-grow">
						<img src="{{$connection.Icon}}" class="width-64 md:height-100%">
					</div>
					<div class="text-gray">{{$connection.Description}}</div>
				</a>
			{{- end -}}
			<div hx-get="/@me/settings/merchantAccount-edit-stripe" class="clickable card padding margin-bottom hover-outline flex-row md:flex-column md:width-25%" role="button">
				<div class="align-center margin-bottom flex-grow">
					<img src="/.templates/user-inbox/resources/stripe.svg" class="width-128 md:height-100%">
				</div>
				<div class="text-gray">Stripe is a sophisticated payment platform for developers and techies.</div>
			</div>
		</div>

	{{- else -}}

		<details class="margin-bottom-xl">
			<summary class="clickable flex-row flex-align-center">
				<h1 class="text-xl bold">
					1. Merchant Account 
				</h1>
				<span class="text-sm" style="color:white; background:var(--green70); border-radius:8px; padding:8px 16px;"> &check; Connected</span>
			</summary>

			<div class="table margin-top">
				{{- range  $index, $merchantAccount := $merchantAccounts -}}
					{{- $type := lowerCase $merchantAccount.Type -}}
					<div role="button" class="flex-row turboclick">
						<div hx-get="/@me/settings/merchantAccount-edit-{{$type}}?merchantAccountId={{$merchantAccount.ID}}" class="flex-row flex-grow">
							<div>{{- icon $type -}}</div>
							<div class="flex-grow">{{$merchantAccount.Name}}</div>
						</div>
					</div>
				{{- end -}}
				<div hx-get="/@me/settings/merchantAccount-add" role="button" class="flex-row link turboclick">
					<div>{{- icon "add" -}}</div>
					<div>Connect Another</div>
				</div>
			</div>
		</details>

		{{- $privileges := .StreamHasPrivileges -}}
		<details class="margin-bottom-xl" {{if not $privileges}} open="true" {{end}} >
			<summary class="clickable flex-row flex-align-center">
				<h1 class="text-xl bold">
					2. Products &amp; Subscriptions
				</h1>
				{{- if $privileges}}
					<span class="text-sm" style="color:white; background:var(--green70); border-radius:8px; padding:8px 16px;"> &check; Connected</span>
				{{- end -}}
			</summary>

			<div class="margin-bottom-lg">
				Now that your merchant account is connected, you can select the products that grant access to this item.
				Visitors purchase access to your content, with either one-time, or recurring payments.
				<a href="https://emissary.dev/products" target="_blank" class="nowrap">{{icon "help"}} Help with Products</a>
			</div>

			<div id="edit-products" hx-get="/{{.StreamID}}/edit-products" hx-trigger="load" hx-target="#edit-products" hx-swap="innerHTML" hx-push-url="false">
				One moment please, loading...
			</div>

		</details>

		{{- .View "edit-paid-content" -}}

	{{- end -}}

	<div class="margin-vertical-xl"></div>

	<div hx-get="/{{.StreamID}}/edit-checkout" hx-trigger="refreshPage from:window" hx-push-url="false"></div>
</div>