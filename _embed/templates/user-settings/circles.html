{{- $isDesktop := .IsDesktop -}}
{{- $circles := .Circles.ByName.Slice -}}

<div class="app" script="init send SelectNav(id:'settings')">
	<title>{{$circles.Length}} Circles | {{.DisplayName}}</title>

	{{- if $isDesktop -}}
		<div id="app-sidebar" class="expanded">
			{{- template "menu" "social" -}}
		</div>
	{{- end -}}
	
	<div class="app-content padding">

		<div id="menu-bar">
			<div class="left">
				{{ if not $isDesktop }}
					<a href="/@me/settings/mobile" hx-boost="true">{{icon "back"}}</a>
				{{ end }}
				<a href="/@me/settings/following" hx-boost="true">Following</a>
				<a href="/@me/settings/followers" hx-boost="true">Followers</a>
				<a href="/@me/settings/circles" class="selected" hx-boost="true">Circles</a>
				<a href="/@me/settings/rules" hx-boost="true">Rules</a>
			</div>
			<div class="right">
				<a href="https://emissary.dev/circles" target="_blank" class="link">
					{{icon "help"}}
					{{ if $isDesktop }} Help with Circles {{ end }}
				</a>
			</div>
		</div>

		<div class="alert-gray">
			Circles enable you to limit the visibility of your posts. Every post can be public (visible to everyone), 
			or limited to the people in the circles you select.<br><br>
			You can add people to circles manually, or <a href="/@me/settings/payments" class="nowrap">set up payments</a>
			to charge for access to circles.
		</div>

		<table class="table">
			<tr hx-get="/@me/settings/circle-add" role="button"><td class="link" colspan="5">
				<span class="margin-right-xs">{{icon "add"}}</span>
				Add a Circle
			</td></tr>
			
			{{- range $index, $circle := $circles -}}
				<tr role="button">
					<td hx-get="/@me/settings/circle-members?circleId={{$circle.ID}}">
						<span class="margin-right-xs xtext-light-gray">{{icon $circle.Icon}}</span>
						{{$circle.Name}}
					</td>
					<td hx-get="/@me/settings/circle-members?circleId={{$circle.ID}}" nowrap>
						<span class="text-light-gray">{{icon "person-fill"}}</span> 
						{{$circle.MemberCount}}
					</td>
					<td hx-get="/@me/settings/circle-members?circleId={{$circle.ID}}" nowrap>
						{{- if $circle.HasProducts -}}
							<span class="text-light-gray">{{icon "box-fill"}}</span> 
							{{$circle.ProductCount -}}
						{{- end -}}
					</td>
					</td>
					<td class="align-right" nowrap>
						<button hx-get="/@me/settings/circle-edit?circleId={{$circle.ID}}" role="button" class="text-xs">Edit Circle</button>
					</td>
				</tr>
			{{- end}}
			
		</table>

	</div>

	<div 
		hx-get="{{.URL}}" 
		hx-trigger="refreshPage from:window" 
		hx-target="main" 
		hx-swap="innerHTML" 
		hx-push-url="false">
	</div>

</div>