{{- $streamID := .QueryParam "streamId" -}}
{{- $stream := .Stream $streamID -}}
{{- $iconURL := $stream.IconURL -}}

<div class="page">

	<div class="margin-bottom">
		<a href="/{{$stream.ID}}">&larr; Back to Item</a>
	</div>
	<div class="flex-row margin-bottom-xl">
		<div>
			{{- if ne "" $iconURL -}}
				<img src="{{$iconURL}}" class="rounded square width-96">
			{{- else -}}
				<div class="rounded square width-96"></div>
			{{- end -}}
		</div>
		<div class="flex-grow">
			<h1 class="text-xl bold margin-none">{{$stream.Label}}</h1>
			<div class="text-gray">
				Configure Purchase Options...
			</div>
		</div>
	</div>

	{{- $merchantAccounts := .MerchantAccounts.Slice -}}

	{{- if eq 0 $merchantAccounts.Length -}}

		<h1 class="text-xl bold">1. Connect Your Merchant Account</h1>
		<div class="text-gray margin-bottom-lg md:width-60%">
			The first step in collecting payments is to set up a merchant account with one of the supported payment procesors below.
			After you've entered your merchant account information, you'll be able to connect the product plan(s) from your merchant account.
		</div>

		<div class="md:flex-row margin-bottom md:text-sm">
			<div hx-get="/@me/settings/merchantAccount-edit-paypal" class="clickable card padding margin-bottom hover-outline flex-row md:flex-column md:width-25%" role="button">
				<div class="align-center margin-bottom flex-grow">
					<img src="/.templates/user-inbox/resources/paypal.png" class="width-64 md:height-100%">
				</div>
				<div class="text-gray"><b>PayPal</b> is a leading payment platform for consumers and small businesses.</div>
			</div>
			<div hx-get="/@me/settings/merchantAccount-edit-stripe" class="clickable card padding margin-bottom hover-outline flex-row md:flex-column md:width-25%" role="button">
				<div class="align-center margin-bottom flex-grow">
					<img src="/.templates/user-inbox/resources/stripe.svg" class="width-128 md:height-100%">
				</div>
				<div class="text-gray"><b>Stripe</b> is a sophisticated payment platform for developers and techies.</div>
			</div>
		</div>

	{{- else -}}

		<h1 class="text-xl bold">
			<span class="text-green">1. Merchant Account Connected &check; </span>
		</h1>

		<div class="table margin-top">
			{{- range  $index, $merchantAccount := $merchantAccounts -}}
				{{- $type := lowerCase $merchantAccount.Type -}}
				<div hx-get="/@me/settings/merchantAccount-edit-{{$type}}?merchantAccountId={{$merchantAccount.ID}}" role="button" class="flex-row turboclick">
					<div>{{- icon $type -}}</div>
					<div>{{$merchantAccount.Name}}</div>
				</div>
			{{- end -}}
			<div hx-get="/@me/settings/merchantAccount-add" role="button" class="flex-row link turboclick">
				<div>{{- icon "add" -}}</div>
				<div>Connect Another</div>
			</div>
		</div>

		<h1 class="margin-top-xl text-xl bold">2. Connect Products</h1>

		{{- $template := .Template $stream.TemplateID -}}
		{{- $roles := $template.PurchasableRoles -}}

		{{- range $index, $role := $roles -}}
			<hr>
			<h2>{{$role.Label}}</h2>
			<div class="text-gray">{{$role.Description}}</div>
		{{- end -}}
		<pre>{{$stream.Products}}</pre>
		<hr>

	{{- end -}}

	<div class="margin-vertical-xl"></div>

	<div hx-get="/@me/settings/stream-products?streamId={{$streamID}}" hx-trigger="refreshPage from:window" hx-push-url="false"></div>
</div>