{{- $merchantAccounts := .MerchantAccounts.Slice -}}

<div class="page app flex-row" script="on load take .selected from .nav-item for #nav-settings">

	<div id="app-sidebar" class="app-sidebar">

		<div class="pos-sticky" style="top:96px;">
	
			<div class="bold text-xl margin-none margin-bottom">Settings</div>
	
			<a href="/@me/settings/following" hx-boost="true" class="turboclick menu-item ellipsis">{{icon "star"}} Following</a>
			<a href="/@me/settings/followers" hx-boost="true" class="turboclick menu-item ellipsis">{{icon "person"}} Followers</a>
			<a href="/@me/settings/circles" hx-boost="true" class="turboclick menu-item ellipsis">{{icon "circle"}} Circles</a>
			<a href="/@me/settings/payments" hx-boost="true" class="turboclick menu-item ellipsis selected">{{icon "credit-card-fill"}} Payments</a>
			<a href="/@me/settings/rules" hx-boost="true" class="turboclick menu-item ellipsis">{{icon "rule"}} Rules</a>
			<a href="/@guest" class="turboclick menu-item ellipsis">{{icon "user"}} Guest Profile</a>
			<hr>
			<a hx-post="/signout" class="button text-xs">Sign Out</a>
		</div>
	
	</div>
	
	<div class="app-content">


		{{- if eq 0 $merchantAccounts.Length -}}

			<h1 class="text-xl bold">
				Accept Payments for your Posts
			</h1>
			
			<div class="margin-bottom-lg  md:width-80% lg:width-60%">
				To sell access to your online posts, you must first sign up and connect to one of the supported payment procesors below.
				<br><br>
				After you've entered your merchant account information, you'll be able to use the product plan(s) from your merchant account to 
				charge for access to this item.
				<a href="https://emissary.dev/payments" class="nowrap" target="_blank">Learn More {{icon "new-window"}}</a>
			</div>

			<div class="md:flex-row margin-bottom md:text-sm">
				{{- $connections := .AvailableMerchantAccounts -}}

				{{- range $index, $connection := $connections -}}
					<a href="/@me/oauth/connect/{{$connection.Value | lowerCase }}" class="text-nocolor card padding margin-bottom hover-outline flex-row sm:flex-column md:width-50% lg:width-33% xl:width-25%" role="button">
						<div class="align-center margin-bottom flex-grow">
							<img src="{{$connection.Icon}}" class="width-64 md:height-100%">
						</div>
						<div class="text-gray">{{$connection.Description}}</div>
					</a>
				{{- end -}}
				<div hx-get="/@me/settings/merchantAccount-edit-stripe" class="clickable card padding margin-bottom hover-outline flex-row sm:flex-column md:width-50% lg:width-33% xl:width-25%" role="button">
					<div class="align-center margin-bottom flex-grow">
						<img src="/.templates/user-inbox/resources/stripe.svg" class="width-128 md:height-100%">
					</div>
					<div class="text-gray">Stripe is a sophisticated payment platform for developers and techies.</div>
				</div>
			</div>

		{{- else -}}

			<div class="flex-row flex-align-center margin-bottom">
				<h1 class="text-xl bold margin-none flex-grow">Merchant Accounts</h1>
				<a href="https://emissary.dev/payments" target="_blank">{{icon "help"}} Help with Payments</a>
			</div>
				
			<div class="table margin-top">
				{{- range  $index, $merchantAccount := $merchantAccounts -}}
					{{- $type := lowerCase $merchantAccount.Type -}}
					<div role="button" class="flex-row turboclick">
						<div hx-get="/@me/settings/merchantAccount-edit-{{$type}}?merchantAccountId={{$merchantAccount.ID}}" class="flex-row flex-grow">
							<div>{{- icon $type -}}</div>
							<div class="flex-grow">{{$merchantAccount.Name}}</div>
						</div>
					</div>
				{{- end -}}
				<div hx-get="/@me/settings/merchantAccount-add" role="button" class="flex-row link turboclick">
					<div>{{- icon "add" -}}</div>
					<div>Connect Another</div>
				</div>
			</div>

			{{- $products := .Products -}}

			{{- if $products.NotEmpty -}}
				{{- $group := groupie -}}

				<div class="margin-top-xl margin-bottom">
					<h1 class="text-xl bold margin-none flex-grow">Products</h1>
				</div>

				<div class="table">
					{{- range $index, $product := $products -}}
							<div class="flex-row flex-align-center">
								<div class="flex-grow">{{icon $product.Icon}} {{$product.Group}}</div>						
								<div class="margin-right-lg text-gray">{{$product.Label}}</div>
								<div>
									<a href="{{$product.Href}}" target="_blank" class="button text-sm">Manage &rarr;</a>
								</div>
							</div>
					{{- end -}}
				</div>
			{{- end -}}

		{{- end -}}
	
	</div>

	<div hx-get="{{.URL}}" hx-trigger="refreshPage from:window" hx-push-url="false"></div>

</div>


