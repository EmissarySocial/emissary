{{- $stream := .ActivityStream .Permalink -}}
{{- $statistics := $stream.Statistics -}}
{{- $inReplyTo := .InReplyTo -}}

<link rel="alternate" type="application/activity+json" href="/{{.StreamID}}"/>

<div class="page h-entry">

	{{- if $inReplyTo.NotNil -}}
		{{- $attributedTo := $inReplyTo.AttributedTo -}}
		<div>
			<a href="{{$inReplyTo.ID}}" class="u-in-reply-to">
				<div class="text-plain">
					<span class="text-gray bold">
						{{icon "reply"}}Replying to {{$attributedTo.Name}} &nbsp;
					</span>
				</div>
				<div class="text-plain text-sm margin-left ellipsis-block" style="max-height:5em;">
					<span class="text-light-gray">{{$inReplyTo.Content | html}}</span>
				</div>
				<div class="text-light-gray text-sm margin-left">
					(Show Full Post)
				</div>
			</a>
		</div>
		<hr>
	{{- end -}}

	<div class="flex-row width-100">

		<div class="margin-right margin-top-sm">
			<a href="{{.Author.ProfileURL}}" class="text-plain inline-block flex-row turboclick">
				{{- if eq .Author.ImageURL "" -}}
					<div class="circle-64"></div>
				{{- else -}}
					<img src="{{.Author.ImageURL}}" class="circle-64">
				{{- end -}}
			</a>
		</div>

		<div class="flex-grow-1">
		
			{{- if .UserCan "edit" -}}
				<div class="float-right">
					<button hx-get="/{{.StreamID}}/edit" hx-push-url="false" class="text-xs">Edit Post</button>
				</div>
			{{- end -}}
		
			<div class="margin-top-sm" style="max-width:720px;">

				<div class="p-author text-xl bold margin-vertical-none">
					<a href="{{.Author.ProfileURL}}" class="text-plain">{{.Author.Name}}</a>
				</div>

				<div class="text-light-gray">
					<span class="p-username">@{{$stream.AttributedTo.PreferredUsername}}</span> &middot;
					<span class="dt-published" datetime="{{.PublishDate | isoDate}}">{{ .PublishDate | humanizeTime }}</span>
				</div>

			</div>

		</div>

	</div>

	<div class="text-lg margin-vertical-lg">
		{{.ContentHTML}}
	</div>

	{{- if ne .ImageURL "" -}}
		<div class="margin-vertical">
			<img src="{{.ImageURL}}?width=600" class="u-photo width-100">
		</div>
	{{- end -}}

	{{- if .UserCan "like-button" -}}
		<div class="margin-vertical text-sm">
			{{.View "like-button"}}
		</div>
	{{- end -}}

	{{- .View "responses-replies" -}}

</div>