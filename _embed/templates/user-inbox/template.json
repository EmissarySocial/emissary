{
	"templateId":"user-inbox",
	"templateRole":"user-inbox",
	"model":"inbox",
	"label":"User Inbox",
	"description":"Inbox displays all incoming messages for the signed-in user",
	"icon":"inbox",
	"extends":["base-social", "base-block-editor"],
	"containedBy": [],
	"schema": {
		"title":"User Profile",
		"type":"object",
		"properties": {
			"feeds": {
				"description":"Array of people to render on the page",
				"type":"array",
				"items": {
					"type":"object",
					"properties": {
						"url": {
							"type":"string"
						},
						"name": {
							"type":"string"
						}
					}
				}
			}
		}
	},
	"states": {
		"default": {
			"label":"Inbox only has default state"
		}
	},
	"roles": {
		"owner": {
			"label":"Inbox Owner",
			"decription":"Full control"
		}
	},
	"bundles": {
		"stylesheet": {
			"contentType":"text/css"
		},
		"hyperscript":{
			"contentType":"text/hyperscript"
		}
	},
	"actions": {

		"test": {
			"roles": ["self"],
			"step": "view-html"
		},
		"inbox": {
			"roles": ["self"],
			"step": "view-html"
		},
		"sidebar": {
			"roles": ["self"],
			"step":"view-html",
			"file":"sidebar-remote"
		},
		"list": {
			"roles": ["self"],
			"steps":[
				{"step":"view-html"}
			]
		},
		"list-before": {
			"roles": ["self"],
			"step":"view-html"
		},
		"filter":{
			"roles":["self"],
			"steps":[
				{"step":"as-modal", "steps":[
					{"step":"view-html"}
				]}
			]
		},
		"folder-add": {
			"roles":["self"],
			"steps": [
				{"step":"set-query-param", "folderId":"new"},
				{"step":"with-folder", "steps": [
					{"step":"as-modal", "steps": [
						{"step":"edit", "form": {
							"type":"layout-vertical",
							"label":"Add a Folder",
							"children": [
								{"type":"text", "path":"label", "label":"Name"},
								{"type":"select", "path":"icon", "label":"Icon", "options":{"provider":"folder-icons"}},
								{"type":"select", "path":"layout", "label":"Layout", "options": {"enum":"CHAT,SOCIAL,NEWSPAPER,MAGAZINE"}}
							]}
						},
						{"step":"save"}
					]},
					{"step":"trigger-event", "event":"closeModal"},
					{"step":"trigger-event", "event":"refreshPage"}
				]}
			]
		},
		"folder-edit": {
			"roles":["self"],
			"steps": [
				{"step":"with-folder", "steps": [
					{"step":"as-modal", "steps": [
						{"step":"edit", "options":["delete:/@me/inbox/folder-delete?folderId={{.ObjectID}}"], "form": {
							"type":"layout-vertical",
							"label":"Folder Settings",
							"children": [
								{"type":"text", "path":"label", "label":"Name"},
								{"type":"select", "path":"icon", "label":"Icon", "options":{"provider":"folder-icons"}},
								{"type":"select", "path":"layout", "label":"Layout", "options": {"enum":"CHAT,SOCIAL,NEWSPAPER,MAGAZINE"}}
							]}
						},
						{"step":"save"}
					]},
					{"step":"trigger-event", "event":"closeModal"},
					{"step":"trigger-event", "event":"refreshPage"}
				]}
			]
		},
		"folder-update":{
			"roles":["self"],
			"steps":[
				{"step":"with-folder", "steps":[
					{"step":"edit", "form": {
						"type":"layout-vertical",
						"children": [
							{"type":"text", "path":"label", "label":"Name"},
							{"type":"text", "path":"layout", "label":"Layout"},
							{"type":"text", "path":"filter", "label":"Filter"}
						]}
					},
					{"step":"save"}
				]},
				{"step":"set-header", "on":"post", "name":"HX-Reswap", "value":"none"},
				{"step":"trigger-event", "event":"refreshPage"}
			]
		},
		"folder-delete": {
			"roles":["self"],
			"steps": [
				{"step":"with-folder", "steps": [
					{"step":"delete", "title":"Delete Folder: {{.Label}}?", "message":"Deleting this folder will also remove all inbox items inside it."},
					{"step":"forward-to", "url":"/@me/inbox"}
				]}
			]
		},
		"folder-sort":{
			"roles":["self"],
			"steps":[
				{"step":"with-folder", "steps":[
					{"step":"sort"}
				]}
			]
		},
		
		"followers": {"step":"view-html", "file":"followers"},
		"followers-list": {"step":"view-html", "file":"followers-list"},
		"follower-add": {
			"roles":["self"],
			"steps":[
				{"step":"as-modal", "steps":[
					{"step":"edit", "form": {
						"type":"layout-vertical",
						"label":"Add Follower",
						"children": [
							{"type":"text", "path":"url", "label":"URL"}
						]
					}},
					{"step":"view-html", "file":"follower"}
				]}
			]
		},
		"follower":{
			"roles": ["self"],
			"steps":[
				{"step":"as-modal", "steps":[
					{"step":"view-html", "file":"follower"}
				]}
			]
		},
		"follower-delete":{
			"roles": ["self"],
			"steps":[
				{"step":"with-follower", "steps":[
					{"step":"delete", "title":"Remove Follower?", "message":"Stop sending updates to '{{.Label}}'?", "button":"Remove"},
					{"step":"trigger-event", "event":"refreshPage"}
				]}
			]
		},

		"following": {"step":"view-html", "file":"following"},
		"following-list": {"step":"view-html", "file":"following-list"},
		"following-search": {
			"roles":["self"],
			"steps":[
				{"step":"as-modal", "steps":[
					{"step":"view-html"}
				]}
			]
		},
		"following-search-results": {
			"roles":["self"],
			"step":"view-html"
		},
		"following-add": {
			"roles":["self"],
			"steps": [
				{"step":"as-modal", "steps":[
					{"step":"view-html"}
				]}
			]
		},
		"following-add-form":{
			"roles":["self"],
			"steps":[
				{"step":"with-following", "steps":[
					{
						"step":"set-data", 
						"from-url":["url", "folderId"]
					}, {
						"step":"edit",
						"options":[
							"endpoint:/@me/inbox/following-add-form?followingId=new",
							"submit-label:Follow this Source",
							"saving-label:Following..."
						],
						"form":{
							"type":"layout-vertical",
							"children": [
								{
									"type":"hidden",
									"path":"url"
								},
								{
									"type":"select", 
									"label":"Content to Show", 
									"path":"behavior", 
									"options":{"provider":"block-behaviors"}
								},
								{
									"type":"select",
									"label":"Folder",
									"path":"folderId",
									"options":{"provider": "folders"},
									"description": "Automatically add items to this folder."
								},
								{
									"type":"select", 
									"label":"Shared Blocks", 
									"path":"blockAction", 
									"options":{"provider":"block-blockActions"}
								},
								{
									"type":"toggle",
									"path":"collapseThreads",
									"default":true,
									"options":{"true-text":"Group messages into a single thread", "false-text":"Show all messages separately"}
								},
								{
									"type":"toggle",
									"path":"isPublic",
									"default":false,
									"options":{"true-text":"Share this 'Follow' on my profile", "false-text":"Hide this 'Follow' from others"}
								}
							]
						}
					}
				]},
				{"step":"trigger-event", "event":"closeModal"},
				{"step":"trigger-event", "event":"refreshPage"}
			]
		},
		"following-edit":{
			"roles":["self"],
			"steps": [
				{"step":"as-modal", "steps":[
					{"step":"with-following", "steps":[
						{"step":"view-html"}
					]}
				]}
			]
		},
		"following-edit-form":{
			"roles":["self"],
			"steps":[
				{"step":"with-following", "steps":[
					{"step":"set-data", "from-url":["folderId"]},
					{
						"step":"edit", 
						"options":[
							"endpoint:/@me/inbox/following-edit-form?followingId={{.ObjectID}}",
							"delete:/@me/inbox/following-delete?followingId={{.ObjectID}}", 
							"delete-label:Stop Following"
						], 
						"form":{
							"type":"layout-vertical",
							"children": [
								{
									"type":"select", 
									"label":"Content to Show", 
									"path":"behavior", 
									"hint": "Which messages from this source should show up in your timeline?",
									"options":{"provider":"block-behaviors"}
								},
								{
									"type":"select",
									"label":"Folder",
									"path":"folderId",
									"options":{"provider": "folders"},
									"description": "Automatically add items to this folder."
								},
								{
									"type":"select", 
									"label":"Shared Blocks", 
									"path":"blockAction", 
									"hint":"When this source blocks someone online, do you want to block them as well?",
									"options":{"provider":"block-blockActions"}
								},
								{
									"type":"toggle",
									"path":"collapseThreads",
									"default":true,
									"options":{"true-text":"Group messages into a single thread", "false-text":"Show all messages separately"}
								},
								{
									"type":"toggle",
									"path":"isPublic",
									"default":false,
									"options":{"true-text":"Share this 'Follow' on my profile", "false-text":"Hide this 'Follow' from others"}
								}
							]
						}
					}
				]},
				{"step":"trigger-event", "event":"closeModal"},
				{"step":"trigger-event", "event":"refreshPage"}
			]
		},
		"following-delete":{
			"roles":["self"],
			"steps":[
				{"step":"with-following", "steps":[
					{"step":"delete", "title":"Stop Following {{.Label}}", "message":"Are you sure you want to delete this follow?"},
					{"step":"trigger-event", "event":"refreshSection"}
				]}
			]
		},

		"actor-button": {
			"roles":["authenticated"],
			"steps": [
				{"step":"view-html"},
				{"step":"set-header", "name":"hx-reswap", "value":"outerHTML"},
				{"step":"set-header", "name":"hx-push-url", "value":"false"}
			]
		},

		"actor-button-follow": {
			"roles":["self"],
			"steps":[
				{"step":"with-following", "steps":[
					{"step":"set-data", "from-url":["folderId", "url"], "values": {"behavior":"POSTS+REPLIES","collapseThreads": "true"}},
					{"step":"save"},
					{"step":"trigger-event", "event":"refreshPeers"},
					{"step":"view-html", "method":"post", "file":"actor-button-follow"}
				]}
			]
		},
		"actor-button-follow-update": {
			"roles":["self"],
			"steps":[
				{"step":"with-following", "steps":[
					{"step":"set-data", "from-form":["behavior", "collapseThreads", "isPublic"]},
					{"step":"save"},
					{"step":"trigger-event", "event":"refreshPeers"},
					{"step":"inline-success", "message":"Saved"}
				]}
			]
		},
		"actor-button-unfollow": {
			"roles":["self"],
			"steps":[
				{"step":"with-following", "steps":[
					{"step":"delete"}
				]},
				{"step":"view-html", "method":"post", "file":"actor-button-none"},
				{"step":"trigger-event", "event":"refreshPeers"},
				{"step":"remove-event", "event":"closeModal"}
			]
		},
		"actor-button-mute":{
			"roles":["self"],
			"steps":[
				{"step":"with-rule", "steps":[
					{"step":"set-data", "values": {"type":"ACTOR", "action": "MUTE", "trigger":"{{.QueryParam `url`}}"}},
					{"step":"save"},
					{"step":"trigger-event", "event":"refreshPeers"},
					{"step":"view-html", "method":"post", "file":"actor-button-mute"}
				]}
			]
		},
		"actor-button-unmute":{
			"roles":["self"],
			"steps":[
				{"step":"with-rule", "steps":[
					{"step":"delete"}
				]},
				{"step":"view-html", "method":"post", "file":"actor-button-none"},
				{"step":"trigger-event", "event":"refreshPeers"},
				{"step":"remove-event", "event":"closeModal"}
			]
		},
		"actor-button-block":{
			"roles":["self"],
			"steps":[
				{"step":"with-rule", "steps":[
					{"step":"set-data", "values": {"type":"ACTOR", "action": "BLOCK", "trigger": "{{.QueryParam `url`}}"}},
					{"step":"save"},
					{"step":"trigger-event", "event":"refreshPeers"},
					{"step":"view-html", "method":"post", "file":"actor-button-block"}
				]}
			]
		},
		"actor-button-block-update": {
			"roles":["self"],
			"steps":[
				{"step":"with-rule", "steps":[
					{"step":"set-data", "from-form":["comment", "isPublic"]},
					{"step":"save"},
					{"step":"trigger-event", "event":"refreshPeers"},
					{"step":"inline-success", "message":"Saved"}
				]}
			]
		},
		"actor-button-unblock":{
			"roles":["self"],
			"steps":[
				{"step":"with-rule", "steps":[
					{"step":"delete"}
				]},
				{"step":"trigger-event", "event":"refreshPeers"},
				{"step":"remove-event", "event":"closeModal"},
				{"step":"view-html", "method":"post", "file":"actor-button-none"}
			]
		},

		"blocks": {
			"roles":["self"],
			"step":"view-html", 
			"file":"blocks"
		},

		"profile": {
			"roles":["self"],
			"steps":[
				{"step":"as-modal", "steps":[
					{"step":"view-html"}
				]}
			]
		},

		"message": {
			"roles":["self"],
			"steps":[
				{"step":"as-modal", "options":["class:large"], "steps":[
					{"step":"view-html"}
				]}
			]
		},
		"message-mute-button":{
			"roles":["self"],
			"steps":[
				{"step":"with-message", "steps":[
					{"step":"view-html"}
				]}
			]
		},
		"message-mute":{
			"roles":["self"],
			"steps":[
				{"step":"with-message", "steps":[
					{"step":"set-state", "state":"MUTED"},
					{"step":"save"},
					{"step":"view-html", "method":"both", "file":"message-mute-button"}
				]}
			]
		},
		"message-unmute":{
			"roles":["self"],
			"steps":[
				{"step":"with-message", "steps":[
					{"step":"set-state", "state":"READ"},
					{"step":"save"},
					{"step":"view-html", "method":"both", "file":"message-mute-button"}
				]}
			]
		},
		"message-delete": {
			"roles": ["self"],
			"steps": [
				{"step":"with-message", "steps":[
					{"step":"delete", "title":"Delete Message?", "message":"Are you sure you want to delete this message?"},
					{"step":"reload-page"}
				]}
			]
		},
		"message-read":{
			"roles":["self"],
			"steps":[
				{"step":"with-message", "steps":[
					{"step":"set-state", "state":"READ"},
					{"step":"save"},
					{"step":"trigger-event", "event":"refreshSidebar"}
				]}
			]
		},

		"responses-announces":{
			"steps": [
				{"step":"view-html"}
			]
		},
		"responses-likes":{
			"steps": [
				{"step":"view-html"}
			]
		},
		"responses-replies":{
			"steps": [
				{"step":"view-html"}
			]
		},
		"responses-replies-list":{
			"roles":["self"],
			"step":"view-html"
		},
		"responses-replies-recursive":{
			"roles":["self"],
			"step":"view-html"
		},
		"reply":{
			"roles":["self"],
			"steps":[
				{"step":"set-args", "postTo":"/@me/inbox/reply?url={{.Permalink}}"},
				{"step":"add-stream", "location":"outbox", "roles":"outbox-reply", "as-embed":true, "with-data":{
					"inReplyTo":"{{.Permalink}}"
				}},
				{"step":"set-header", "name":"hx-retarget", "value":"#responses"},
				{"step":"set-header", "name":"hx-reswap", "value":"outerHTML"},
				{"step":"view-html", "method":"post", "file":"responses-replies"}
			]
		}
	}
}	
