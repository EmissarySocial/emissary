{{- $uri := .QueryParam "uri" -}}
{{- $messageID := .QueryParam "messageId" -}}
{{- $folderID := .QueryParam "folderId" -}}
{{- $followingID := .QueryParam "origin.followingId" -}}

{{- $stream := .ActivityStream $uri -}}
{{- $message := .Message -}}

<div id="modal-header">

	<div>
		<div class="flex-row text-xs">

			<div style="flex-grow:1">
	
				{{- if not $message.IsNew -}}
					<span class="button-group" script="install message(messageId:'{{$messageID}}')">
						<button id="previous" hx-get="/@me/messages/{{$message.MessageID}}/view?sibling=prev&followingId={{$followingID}}">&laquo; Prev</button>
						<button id="next" hx-get="/@me/messages/{{$message.MessageID}}/view?sibling=next&followingId={{$followingID}}">Next &raquo;</button>
					</span>

					<span class="button-group">
						<button script="on click go to url '{{$message.URL}}' in new window">View Original</button>
						<button hx-get="/@me/following-edit?followingId={{$message.Origin.FollowingID.Hex}}">Edit Source</button>
						<button hx-get="/@me/messages/{{$message.MessageID}}/delete">Delete</button>
					</span>
				{{- end -}}
	
			</div>

			<div class="align-right">
				<button script="on click send closeModal">Close</button>
			</div>
		
		</div>

	</div>

</div>

<div id="modal-body">

	{{- if not $message.IsNew -}}
	
		{{- if ne "DIRECT" $message.Origin.Type -}}
		
			<div class="bold text-sm text-gray italics">
				{{- if eq "LIKE" $message.Origin.Type -}}
					{{icon "thumbs-up-fill"}} 
					<a class="text-gray" href="/@me/inbox/folderId={{$message.FolderID}}&origin.followingId={{$message.Origin.FollowingID.Hex}}">{{$message.Origin.Label}}</a> 
					Liked this
	
				{{- else if eq	"DISLIKE" $message.Origin.Type -}}
					{{icon "thumbs-down-fill"}} 
					<a class="text-gray" href="/@me/inbox/folderId={{$message.FolderID}}&origin.followingId={{$message.Origin.FollowingID.Hex}}">{{$message.Origin.Label}}</a>
					Disliked
		
				{{- else if eq "ANNOUNCE" $message.Origin.Type -}}
					{{icon "rocket-fill"}} 
					<a class="text-gray" href="/@me/inbox/folderId={{$message.FolderID}}&origin.followingId={{$message.Origin.FollowingID.Hex}}">{{$message.Origin.Label}}</a>
					Boosted this
		
				{{- else if eq "REPLY" $message.Origin.Type -}}
					{{icon "reply-fill"}} 
					<a class="text-gray" href="/@me/inbox/folderId={{$message.FolderID}}&origin.followingId={{$message.Origin.FollowingID.Hex}}">{{$message.Origin.Label}}</a>
					Replied to this

				{{- end -}}
			</div>

		{{- end -}}

	{{- end -}}

	{{- if $stream.AttributedTo.NotNil -}}
		<div>
			<a class="flex-row flex-align-center text-plain text-lg" href="{{$stream.AttributedTo.ID}}">
				{{- if $stream.AttributedTo.Image.NotNil -}}
					<img src="{{$stream.AttributedTo.Image.URL}}" class="circle-64">
				{{- else -}}
					<div class="circle-64"></div>
				{{- end -}}
				<div>
					<div class="text-plain text-lg bold margin-vertical-none">{{$stream.AttributedTo.Name}}</div>
					<div class="text-gray text-sm margin-vertical-none">{{$stream.AttributedTo.ID}}</div>
				</div>
			</a>
		</div>
	{{- end -}}

	<div class="flex-row">
		<div style="width:64px;"></div>
		<div class="flex-grow-1">
					
			{{- if ne "" $stream.Name -}}
				<h1 class="margin-vertical-lg"><a href="{{$stream.URL}}" target="_blank" class="text-black">{{$stream.Name}}</a></h1>
			{{- end -}}

			<div class="content">

				{{- $image := $stream.Image -}}
				{{- if $image.NotNil -}}
					<div class="margin-bottom">
						<img src="{{$image.URL}}" style="width:100%; {{- if $image.HasDimensions}} aspect-ratio:{{$image.AspectRatio}};{{end}}"/>
					</div>
				{{- end -}}

				{{- if $stream.HasContent -}}
					<div>{{- $stream.Content | html -}}</div>
				{{- else if $stream.HasSummary -}}
					<div>{{- $stream.Summary -}}</div>
				{{- end -}}

				<div class="margin-top text-sm text-light-gray">{{ $stream.Published | shortDate -}}</div>

			</div>

			<div class="margin-top-lg text-sm">{{.View "like-button"}}</div>

		</div>
		
	</div>

	{{.View "responses-replies"}}

</div>

<div id="modal-footer">
	{{.View "reply"}}
</div>