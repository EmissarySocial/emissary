{{- $builder := index . 0 -}}
{{- $document := index . 1 -}}

{{- $attributedTo := $document.AttributedTo -}}
{{- $inReplyTo := $document.InReplyTo -}}
{{- $inReplyToAttributedTo := $inReplyTo.AttributedTo -}}

<div id="modal-header">

	<div>
		<div class="flex-row text-xs">

			<div class="flex-grow-1">

				<span class="button-group">
					<a href="{{$document.ID}}" target="_blank" class="button">{{icon "globe"}} Website</a>
				</span>
			</div>

			<div>
				<span class="button-group">	
					<button script="on click send closeModal">Close</button>
				</span>
			</div>
		
		</div>

	</div>

</div>

<div id="modal-body" class="padding-top">

	{{- if $inReplyTo.NotNil -}}
		<div class="flex-row margin-bottom">
			<div role="link" class="italics text-sm link" hx-get="/@me/inbox/browse?&url={{$inReplyTo.ID}}">
				{{icon "reply-fill"}} Replying to {{$inReplyToAttributedTo.Name}}...
			</div>
		</div>
	{{- end -}}

	{{- if $attributedTo.NotEmpty -}}

		<div class="flex-row margin-bottom">
			<span hx-get="/@me/inbox/browse?url={{$attributedTo.ID}}" class="flex-grow-1 flex-row flex-align-center text-plain">
				{{- if $attributedTo.Icon.NotNil -}}
					<img src="{{$attributedTo.Icon.Href}}" class="circle width-64">
				{{- end -}}
				<div>
					<div class="text-plain text-lg bold margin-vertical-none">{{$attributedTo.Name}}</div>
					<div class="text-light-gray margin-vertical-none">{{$attributedTo.UsernameOrID}}</div>
				</div>
			</span>
		</div>

	{{- end -}}

	<div>
				
		{{- if ne "" $document.Name -}}
			<h1 class="margin-top-sm margin-bottom-lg"><a href="{{$document.URLOrID}}" target="_blank" class="text-black">{{$document.Name}}</a></h1>
		{{- end -}}

		<div class="content">

			{{- if not (hasImage $document.Content) -}}
				{{- $image := $document.ImageOrIcon -}}
				{{- if $image.NotNil -}}
					<div class="margin-bottom">
						<a href="{{$document.URLOrID}}" target="_blank"><img src="{{$image.URL}}" class="width-100%" style="{{- if $image.HasDimensions}} aspect-ratio:{{$image.AspectRatio}};{{end}}"/></a>
					</div>
				{{- end -}}
			{{- end -}}

			{{- if $document.HasContent -}}
				<div>{{- $document.Content | html -}}</div>
			{{- else if $document.HasSummary -}}
				<div>{{- $document.Summary -}}</div>
			{{- end -}}

			<div class="margin-bottom text-sm text-light-gray">{{ $document.Published | shortDate -}}</div>

			{{- template "tags" $document -}}

		</div>

		<div class="margin-top-lg text-xs">
			{{$builder.View "like-button"}}

			{{- if $builder.NotMe $attributedTo.ID -}}
				<div hx-get="/@me/inbox/actor-button?url={{$attributedTo.ID}}" hx-target="this" hx-swap="outerHTML" hx-trigger="modalReady from:window" hx-push-url="false"></div>
			{{- end -}}
		</div>
		
	</div>

	<div class="margin-left-md">
		<div hx-get="/@me/inbox/responses-replies?url={{$document.ID}}" hx-trigger="load" hx-target="this" hx-swap="outerHTML" hx-push-url="false">
			{{- template "responses-menu" $document -}}
			<span class="spin">{{icon "loading"}}</span> Loading Replies
		</div>
	</div>

	<pre><code>{{ $document | jsonIndent }}</code></pre>

</div>

<!--div id="modal-footer">
	{{.View "reply"}}
</div-->