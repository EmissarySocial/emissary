{{- $merchantAccounts := .MerchantAccounts.ByName.Slice -}}

{{- if eq 1 $merchantAccounts.Length -}}

	{{- $true := .SetQueryParam "merchantAccountId" $merchantAccounts.First.ID -}}
	{{- .View "subscription-edit-inner" -}}

{{- else if $merchantAccounts.NotEmpty -}}

	<h1>{{icon "add"}} Add a Subscription Plan</h1>

	<p>Which merchant account do you want to use for this subscription plan?</p>

	<div class="table margin-top">
		{{- range $index, $merchantAccount := $merchantAccounts -}}
			{{- $type := lowerCase $merchantAccount.Type -}}
			<div class="flex-row" role="button">
				<div hx-get="/@me/inbox/subscription-edit-{{$type}}?merchantAccountId={{ $merchantAccount.ID }}" class="flex-grow">
					{{icon $type}} {{ $merchantAccount.Name}}
				</div>
				<div>
					<button class="button text-sm" hx-get="/@me/inbox/merchantAccount-edit?merchantAccountId={{ $merchantAccount.ID }}">
						Edit
					</button>
				</div>
			</div>
		{{- end -}}
	</div>

	<div class="margin-top flex-row">
		<div class="flex-grow">
			<button script="on click trigger closeModal">Cancel</button>
		</div>
		<a href="/@me/inbox/merchantAccounts" hx-boost="true">Edit Merchant Accounts</a>
	</div>

{{- else -}}

	<h1>{{icon "add"}} Add a Subscription Plan</h1>

	<p>Subscriptions let you to charge your followers for online access to your posts and content. 
		<a href="https://emissary.dev/subscriptions" target="_blank">Learn more {{icon "new-window"}}</a>
	</p>

	<ol>
		<li>Connect a Merchant Account.</li>
		<li>Create Subscription Plan(s).</li>
		<li>Followers Can Become Subscribers.</li>
	</ol>

	<div class="margin-top-lg">
		<button hx-get="/@me/inbox/merchantAccount-add?next=add-subscription" class="primary">
			Connect My Merchant Account &rarr;
		</button>

		<button script="on click trigger closeModal">Cancel</button>
	</div>

{{- end -}}

