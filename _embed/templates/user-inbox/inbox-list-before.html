{{- $inbox := .Inbox.Top12.ByRank.Reverse.Slice.Reverse -}}

{{- if gt (len  $inbox) 0 -}}

	{{- $firstMessage := $inbox.First -}}
	{{- $folders := .FoldersWithSelection}}
	{{- $folder := $folders.Selected}}
	{{- $folderID := $folder.FolderID.Hex -}}

	{{- $internalID := .QueryParam "origin.followingId" -}}
	{{- $layout := $folder.Layout | lowerCase -}}
	{{- $parentRenderer := . -}}

	<div 
		hx-get="/@me/inbox/inbox-list-before?folderId={{$folderID}}&origin.followingId={{$internalID}}&rank=LT:{{$firstMessage.Rank}}"
		hx-target="this"
		hx-swap="outerHTML"
		hx-push-url="false"
		role="button"
		class="space-below">
		<button class="text-xs">&uarr; Older than {{ divide $firstMessage.Rank 1000 | longDate }}</button>
		<div style="border-top:solid 2px var(--gray30);"></div>
	</div>

	{{- range $index, $message := $inbox -}}

		{{- $messageRenderer := ($parentRenderer.MessageRenderer $message) -}}

		<div 
			id="item_{{.MessageID.Hex}}" 
			role="button"
			class="message" 
			style="max-width:640px;"
			hx-get="/@me/messages/{{.MessageID.Hex}}?origin.followingId={{$internalID}}"
			hx-push-url="false">

			{{- if eq "SOCIAL" $folder.Layout -}}
				{{- template "inbox-list-social" $messageRenderer -}}
			{{- else if eq "CHAT" $folder.Layout -}}
				{{- template "inbox-list-chat" $messageRenderer -}}
			{{- else if eq "NEWSPAPER" $folder.Layout -}}
				{{- template "inbox-list-newspaper" $messageRenderer -}}
			{{- else if eq "MAGAZINE" $folder.Layout -}}
				{{- template "inbox-list-magazine" $messageRenderer -}}
			{{- else -}}
				{{- template "inbox-list-social" $messageRenderer -}}
			{{- end -}}

		</div>

		<hr>

	{{- end -}}

{{- end -}}



