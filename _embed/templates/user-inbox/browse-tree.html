{{- $url := .QueryParam "url" -}}
{{- $document := .ActivityStream $url -}}

{{- template "browse-header" (array $url "tree") -}}

<div id="modal-body" class="turboclick padding-top" hx-target="#modal-window" hx-swap="innerHTML" hx-push-url="false">

	<!-- Displays this record and all of its parents -->
	{{- template "browse-parent" (array . $document "") -}}

	{{- $repliesURL := $document.Replies.ID -}}
	{{- if ne "" $repliesURL -}}
		<div 
			hx-get="/@me/inbox/browse-tree-replies?url={{$repliesURL}}" 
			hx-trigger="intersect once" 
			hx-target="this" 
			hx-swap="outerHTML" 
			hx-push-url="false"
			class="card padding margin-bottom text-light-gray">

			<span class="spin">{{icon "loading"}}</span> Searching for Replies
		</div>
	{{- end -}}

</div>

<script type="text/hyperscript">
	init
	set selectedNode to #id_{{$document.Metadata.HashedID}} 
	take .selected from .card for the selectedNode then
	scrollIntoView() the selectedNode
</script>

