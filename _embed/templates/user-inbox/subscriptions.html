{{- $folders := .Folders -}}
{{- $subscriptions := .Subscriptions.ByName.Slice -}}

<div class="page app flex-row">
	<title>{{.RuleCount}} Rules | {{.DisplayName}}</title>
	<link rel="stylesheet" href="/.templates/user-inbox/stylesheet">

	{{- template "sidebar" $folders -}}

	<div class="app-content">

		<div role="tablist" class="underlined margin-top margin-bottom" hx-push-url="true">
			<span role="tab" class="turboclick" hx-get="/@me/inbox/following">{{icon "star"}} Following</span>
			<span role="tab" class="turboclick" hx-get="/@me/inbox/followers">{{icon "person"}} Followers</span>
			<span role="tab" class="turboclick" hx-get="/@me/inbox/rules">{{icon "rule"}} Rules</span>
			<span role="tab" class="turboclick" hx-get="/@me/inbox/subscriptions" aria-selected="true">{{icon "person-card-fill"}} Subscriptions</span>
		</div>

		{{- if $subscriptions.NotEmpty -}}

			<div role="tablist" class="align-right pills margin-top margin-bottom" hx-push-url="true">
				<span role="tab" class="turboclick" hx-get="/@me/inbox/subscribers">Subscribers</span>
				<span role="tab" class="turboclick" hx-get="/@me/inbox/subscriptions" aria-selected="true">Plans</span>
				<span role="tab" class="turboclick" hx-get="/@me/inbox/merchantAccounts">Merchant Accounts</span>
			</div>

			<div class="table margin-top">
				<div hx-get="/@me/inbox/subscription-add" role="button" class="link">
					{{icon "add"}} Add a Subscription Plan
				</div>

				{{- range $index, $subscription := $subscriptions -}}
					<div role="button">
						{{icon "card"}} {{$subscription.URL}}
					</div>
				{{- end -}}

			</div>

		{{- else -}}

			{{- $merchantAccounts := .MerchantAccounts.Count -}}
		
			<div class="margin-top">
				<div class="alert-blue">
					Subscriptions let you charge your followers for online access to your posts and content.
					You'll need an account with <b>PayPal</b> or <b>Stripe</b> to begin.
					<a href="https://emissary.dev/subscriptions" target="_blank">Learn more {{icon "new-window"}}</a>
					<br>
					<br>

					{{- if eq 0 $merchantAccounts -}}
						<button hx-get="/@me/inbox/merchantAccount-add?next=subscription-add" class="primary">{{icon "add"}} Add a Merchant Account</button>
					{{- else -}}
						<button hx-get="/@me/inbox/subscription-add" class="primary">{{icon "add"}} Add a Subscription Plan</button>
					{{- end -}}
				</div>
			</div>
		
		{{- end -}}			
	
	</div>

	<div hx-get="{{.URL}}" hx-trigger="refreshPage from:window" hx-push-url="false"></div>

</div>