{{- $inboxRenderer := index . 0 -}}
{{- $message := index . 1 -}}
{{- $stream := $inboxRenderer.ActivityStream $message.URL -}}
{{- $attributedTo := $stream.AttributedTo -}}

<div class="flex-row">
	<div class="width-32 margin-right-sm">
		{{- if $attributedTo.Icon.NotNil -}}
			<img src="{{$attributedTo.Icon.Href}}" class="circle-32">
		{{- else -}}
			<div class="circle-32"></div>
		{{- end -}}
	</div>

	<div>

		{{- if ne "" $attributedTo.Name -}}
			<div>
				<span class="bold black">{{$attributedTo.Name}}</span>
				<span class="text-light-gray nowrap flex-grow-1">
					{{- if ne "" $attributedTo.PreferredUsername -}}
						&middot;
						@{{$attributedTo.PreferredUsername}}
					{{- end -}}
				</span>
			</div>
		{{- end -}}

		{{- if ne "" $stream.Name -}}
			<div>
				<span class="bold black">{{$stream.Name}}</span>
			</div>
		{{- end -}}

		<div>
			{{- if $stream.HasContent -}}
				{{- $stream.Content | htmlMinimal -}}
			{{- else if $stream.HasSummary -}}
				{{- $stream.Summary | htmlMinimal -}}
			{{- end -}}
		</div>

		{{- if $stream.Image.NotNil -}}
			<div class="margin-top" style="position:relative;">
				<img src="{{$stream.Image.Href}}" loading="lazy" style="width:100%; border-radius:16px; border: solid 1px var(--gray40);"/>
			</div>
		{{- end -}}

		<div class="margin-top text-sm text-light-gray">

			{{- $stats := $stream.Statistics -}}
			{{- $message.PublishDate | tinyDate }} ago

			{{ if gt $stats.Replies 0 -}}
				&middot; {{$stats.Replies}} {{pluralize $stats.Replies "Reply" "Replies"}}
			{{- end }}

			{{ if gt $stats.Likes 0 -}}
				&middot; {{$stats.Likes}} {{pluralize $stats.Likes "Like" "Likes"}}
			{{- end }}

			{{ if gt $stats.Announces 0 -}}
				&middot; {{$stats.Announces}} {{pluralize $stats.Announces "Share" "Shares"}}
			{{- end }}

		</div>

	</div>
</div>

