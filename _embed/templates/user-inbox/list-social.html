{{- $inboxRenderer := index . 0 -}}
{{- $message := index . 1 -}}
{{- $stream := $inboxRenderer.ActivityStream $message.URL -}}

<div class="flex-row">
	<div>
		{{- if $stream.AttributedTo.Image.NotNil -}}
			<img src="{{$stream.AttributedTo.Image.URL}}" class="circle-32 margin-right-sm">
		{{- else -}}
			<div class="circle-32 margin-right-sm"></div>
		{{- end -}}
	</div>

	<div>

		<div>
			<span class="bold black">{{$stream.AttributedTo.Name}}</span>
			<span class="text-light-gray nowrap flex-grow-1">
				&middot;
				@{{$stream.AttributedTo.PreferredUsername}} &middot;
			</span>
			
		</div>

		{{- if ne "" $stream.Name -}}
			<div class="bold text-black margin-top">{{$stream.Name}}</div>
		{{- end -}}

		<div>
			{{- if $stream.HasContent -}}
				{{- $stream.Content | htmlMinimal -}}
			{{- else if $stream.HasSummary -}}
				{{- $stream.Summary | htmlMinimal -}}
			{{- end -}}
		</div>

		{{- if $stream.Icon.NotNil -}}
			<div class="margin-top" style="position:relative;">
				<img src="{{$stream.Icon.URL}}" loading="lazy" style="width:100%; border-radius:16px; border: solid 1px var(--gray40);"/>
			</div>
		{{- end -}}

		<div class="margin-top text-sm text-light-gray">

			{{- $stats := $stream.Statistics -}}
			{{- $stream.Published | tinyDate }} ago

			{{ if gt $stats.Replies 0 -}}
				&middot; {{$stats.Replies}} {{pluralize $stats.Replies "Reply" "Replies"}}
			{{- end }}

			{{ if gt $stats.Likes 0 -}}
				&middot; {{$stats.Likes}} {{pluralize $stats.Likes "Like" "Likes"}}
			{{- end }}

			{{ if gt $stats.Announces 0 -}}
				&middot; {{$stats.Announces}} {{pluralize $stats.Announces "Share" "Shares"}}
			{{- end }}

		</div>

	</div>
</div>

