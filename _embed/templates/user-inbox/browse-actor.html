{{- $url := .QueryParam "url" -}}
{{- $actor := .ActivityStream $url -}}

{{- $following := .AmFollowing $actor.ID -}}
{{- $follower := .IsFollower $actor.ID -}}
{{- $search := .QueryParam "search" -}}
{{- $folderID := .QueryParam "folderId" -}}
{{- $url := $actor.ID -}}

<div id="modal-header" class="turboclick" hx-target="#modal" hx-swap="innerHTML">
	<div role="tablist" class="pills margin-bottom-none">

		{{- if ne "" $search -}}
			<span role="link" class="link margin-right" hx-get="/@me/settings/following-search?search={{$search}}&folderId={{$folderID}}">
				&larr; Search
			</span>
		{{- end -}}

		<button role="tab" hx-get="/@me/inbox/browse-actor?url={{$url}}&search={{$search}}&folderId={{$folderID}}" aria-selected="true">{{icon "person"}} Profile</button>
		<button role="tab" hx-get="/@me/inbox/annotation?url={{$actor.ID}}&search={{$search}}&folderId={{$folderID}}">{{icon "note"}} Notes</button>

		{{ if $following.IsNew -}}
			<button role="tab" hx-get="/@me/settings/following-edit?url={{$actor.ID}}&search={{$search}}&folderId={{$folderID}}">{{icon "add"}} Follow</button>
		{{- else -}}
			<button role="tab" hx-get="/@me/settings/following-edit?url={{$actor.ID}}&search={{$search}}&folderId={{$folderID}}">{{icon "check"}} Following</button>
		{{- end }}

		{{ if $follower.IsNew -}}
			<span class="text-light-gray margin-left" disabled>Doesn't Follow You</span>
		{{- else -}}
			<button role="tab" hx-get="/@me/settings/follower?followerId={{$follower.FollowerID.Hex}}&search={{$search}}&folderId={{$folderID}}">{{icon "check"}} Follows You</button>
		{{- end }}
	</div>
</div>

<div id="modal-body" class="pos-relative">

	{{- if $actor.HasImage -}}
		<div class="margin-bottom">
			<img src="{{$actor.Image.Href}}" class="width-100% object-fit-cover" style="max-height:240px">
		</div>
	{{- end -}}

	<div class="flex-row margin-bottom">
		<div class="flex-grow flex-row flex-align-center text-plain">
			{{- if $actor.Icon.NotNil -}}
				<img src="{{$actor.Icon.Href}}" class="circle width-64">
			{{- else -}}
				<div class="circle width-64"></div>
			{{- end -}}
			<div>
				<div class="text-plain text-lg bold margin-vertical-none">{{$actor.Name}}</div>
				<div class="text-light-gray margin-vertical-none">{{$actor.UsernameOrID}}</div>
			</div>
		</div>
	</div>

	<div class="flex-row">
		<div class="width-64 flex-shrink-0"></div>
		<div class="text-sm">
			<!--
			<button hx-get="/@me/inbox/conversation-new?actorId={{$actor.ID}}" class="primary">{{icon "chat"}} Direct Message</button>
			-->
			<a class="button outline" href="{{$actor.ID}}" target="_blank">{{icon "globe"}} Website</a>
		</div>
	</div>

	{{- if ne "" $actor.Summary -}}
		<div class="margin-vertical">
			{{- $actor.SummaryWithTagLinks | htmlMinimal -}}
		</div>

	{{- else if $actor.Tag.NotEmpty -}}
		<div class="margin-vertical text-xs">
			{{- range $tag := $actor.Tag.Range -}}
				<a href="{{$tag.Href}}" target="_blank" class="button">{{$tag.Name}}</a>
			{{- end -}}
		</div>
	{{- end -}}

	{{- if $actor.Attachment.NotEmpty -}}
		<table class="table margin-vertical-lg">
			{{range $attachment := $actor.Attachment.Range}}
				{{- $attachmentValue := $attachment.Get "value" -}}
				{{- $attachmentValue := $attachmentValue.String -}}
				<tr role="link" script="on click go to url {{$attachmentValue}} in new window">
					<td nowrap>{{$attachment.Name}}</td>
					<td style="width:100%">{{$attachmentValue}}</td>
				</tr>
			{{end}}
		</table>
	{{- end -}}

	{{- $featured := $actor.Featured.String -}}
	{{- if ne "" $featured -}}
		<div
			hx-get="/@me/inbox/browse-actor-featured?collection={{$featured}}"
			hx-trigger="load"
			hx-target="this"
			hx-swap="outerHTML"
			hx-push-url="false">
			<div class="margin-top bold"><span class="spin">{{icon "loading"}}</span> Loading Featured Posts...</div>
		</div>
	{{- end -}}
	
</div>
	
