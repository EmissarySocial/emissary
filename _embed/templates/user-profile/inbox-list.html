{{- $inbox := .Inbox -}}
{{ $isReallyEmpty := .IsInboxEmpty $inbox}}

{{- if $isReallyEmpty -}}

	<h2>There are no posts in this inbox.</h2>
	<button hx-get="/people/me/add-subscription">Add a new subscription</button>

{{- else -}}

	{{- if eq 0 (len $inbox) -}}
		<div>The end.</div>

	{{- else -}}

		{{- $lastIndex := subtract (len $inbox) 1 -}}
		{{- $last := index $inbox $lastIndex -}}
		<div hx-get="/people/me/inbox-list?publishDate=GT:{{$last.PublishDate}}" hx-push-url="false" hx-trigger="intersect once" hx-target="#loading" hx-swap="outerHTML"></div>

		{{- range $inbox -}}
			<div id="item_{{.InboxItemID.Hex}}" class="inbox-item" data-status="{{.Status}}" data-inboxItemId="{{.InboxItemID.Hex}}" style="max-width:640px; cursor:pointer;" data-script="on click go to url '{{.Origin.URL}}' in new window">

				<div class="flex-row" hx-push-url="true">

					<div style="flex-grow:1; min-width:0px; position:relative; width:100%; max-width:100%;">
						<div class="bold black" style="line-height:1em; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;">{{.Label}}</div>
						<div class="text-gray text-sm space-below" style="line-height:1em;">
							{{icon .Origin.Icon}}
							{{.Author.Name}}
							&middot;
							{{.PublishDate | tinyDate}}
						</div>
						<div class="text-gray" style="text-overflow:ellipsis; overflow:hidden; max-height:6em;">{{.Summary}}</div>
					</div>
				
					{{- if ne .ImageURL "" -}}
						<div style="width:160px;">
							<div style="width:140px; margin-right:20px; min-height:84px; border:solid 1px var(--gray20); background-color:var(--gray10);">
									<img src="{{.ImageURL}}" loading="lazy" style="width:140px; max-height:140px; object-fit:cover;"/>
							</div>
						</div>
					{{- end -}}

				</div>

				<hr style="height:0px; border:none; border-top:solid 1px var(--gray20);"></hr>
				<div style="height:30px;"></div>
			</div>
		{{- end -}}

		<!-- Trigger to load more records at the end of this-->
		<div id="loading">Just a sec.  Loading more...</div>
	
	{{- end -}}

{{- end -}}
