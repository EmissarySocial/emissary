{{- $inbox := .Inbox -}}
{{ $isReallyEmpty := .IsInboxEmpty $inbox}}

{{- if $isReallyEmpty -}}

	<h2>There are no posts in this inbox.</h2>
	<button hx-get="/@me/pub/subscriptions/new">Add a new subscription</button>

{{- else -}}

	{{- if eq 0 (len $inbox) -}}
		<div>The end.</div>

	{{- else -}}

		{{- $lastIndex := subtract (len $inbox) 1 -}}
		{{- $last := index $inbox $lastIndex -}}
		<div hx-get="/@me/inbox-list?publishDate=GT:{{$last.PublishDate}}" hx-push-url="false" hx-trigger="intersect once" hx-target="#loading" hx-swap="outerHTML"></div>

		{{- range $inbox -}}
			<hr style="height:0px; border:none; border-top:solid 1px var(--gray20); margin:24px 0px;"></hr>

			<div id="item_{{.ActivityID.Hex}}" class="inbox-item" data-status="{{.Status}}" data-inboxItemId="{{.ActivityID.Hex}}" style="max-width:640px; cursor:pointer;" 
				hx-get="/@me/activity?activityId={{.ActivityID.Hex}}"
				xdata-script="on click halt the event then go to url '{{.Object.URL}}' in new window">

				<div class="flex-row" hx-push-url="true">

					<div style="flex-grow:1; min-width:0px; position:relative; width:100%; max-width:100%;">
						<div class="bold black" style="line-height:1em; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;">{{.Object.Label}}</div>
						<div class="text-gray text-sm space-below" style="line-height:1em;">
							{{ icon .Origin.Icon }} &nbsp;
							{{ .Actor.Name }} 
							&middot; 
							{{ .Actor.Organization }}
							&middot;
							{{ .PublishDate | tinyDate }}
						</div>
						<div class="text-gray" style="text-overflow:ellipsis; overflow:hidden; max-height:6em;">{{.Object.Summary}}</div>
					</div>
				
					{{- if ne .Object.ImageURL "" -}}
						<div style="width:160px;">
							<div style="width:140px; margin-right:20px; min-height:84px; border:solid 1px var(--gray20); background-color:var(--gray10);">
								<img src="{{.Object.ImageURL}}" loading="lazy" style="width:140px; max-height:140px; object-fit:cover;"/>
							</div>
						</div>
					{{- end -}}

				</div>

			</div>
		{{- end -}}

		<!-- Trigger to load more records at the end of this-->
		<div id="loading">Just a sec.  Loading more...</div>
	
	{{- end -}}

{{- end -}}
