{{- $folders := .Folders -}}
{{- $folderID := .QueryParam "folderId" -}}
{{- if eq "" $folderID -}}
	{{- $folderID = (index $folders 0).FolderID.Hex -}}
{{- end -}}

<div id="app-sidebar" class="app-sidebar" hx-target="#main" hx-swap="innerHTML" hx-push-url="true">

	<link rel="stylesheet" href="/.templates/user-profile/stylesheet">

	<div class="pos-sticky" style="top:100px;">

		<form class="sortable" hx-post="/@me/inbox-folder-sort" hx-push-url="false" hx-trigger="end">

			{{- range .Folders -}}
				{{- if (eq .FolderID.Hex $folderID) -}}
					<div role="link" hx-get="/@me/inbox?folderId={{.FolderID.Hex}}" hx-trigger="click" hx-push-url="true" class="selected ellipsis hover-trigger folder">
						{{icon "folder-fill"}} {{.Label}}
						<span class="hover-reveal folder-handle">{{icon "drag-handle"}}</span>
						<input type="hidden" name="folderId" value="{{.FolderID.Hex}}">
					</div>
				{{- else -}}
					<div role="link" hx-get="/@me/inbox?folderId={{.FolderID.Hex}}" hx-trigger="click" hx-push-url="true" class="ellipsis hover-trigger folder">
						{{icon "folder"}} {{.Label}}
						<span class="hover-reveal folder-handle">{{icon "drag-handle"}}</span>
						<input type="hidden" name="folderId" value="{{.FolderID.Hex}}">
					</div>
				{{- end -}}
			{{- end -}}

		</form>

		<div role="button" hx-get="/@me/inbox-folder-add">{{icon "add"}} Add a Folder</div>
		<hr>
		<div role="button" hx-get="/@me/following">{{icon "settings"}} Manage Follows</div>
	</div>

	<div 
		hx-get="/@me/inbox-sidebar" 
		hx-swap="outerHTML" 
		hx-trigger="refreshSidebar from:body" 
		hx-push-url="false" 
		hx-target="#app-sidebar">
	</div>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

	<script>
        var sortables = document.querySelectorAll(".sortable");
        for (var node of sortables) {
            new Sortable(node, {
                animation: 150,
				handle: '.folder-handle',
                whisperClass: 'folder-whisper'
            });
        }
    </script>

</div>
