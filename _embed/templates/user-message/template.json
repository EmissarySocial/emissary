{
	"templateId":"user-message",
	"templateRole":"user-message",
	"model":"message",
	"label":"Message Viewer",
	"description":"Message displays a single message and related parents/responses/replies",
	"icon":"inbox",
	"extends":["base-social"],
	"containedBy": [],
	"schema": {
		"title":"Message",
		"type":"object",
		"properties": {}
	},

	"bundles": {
		"stylesheet": {
			"contentType":"text/css"
		},
		"hyperscript":{
			"contentType":"text/hyperscript"
		}
	},
	"actions": {

		"view-single": {
			"roles":["self"],
			"steps":[
				{"step":"view-html"}
			]
		},
		"view": {
			"roles":["self"],
			"steps":[
				{"step":"as-modal", "options":["class:large"], "steps":[
					{"step":"view-html", "file":"view"}
				]}
			]
		},

		"reply":{
			"roles":["self"],
			"steps":[
				{"step":"set-render-data", "postTo":"/@me/messages/{{.MessageID}}/reply"},
				{"step":"add-stream", "location":"outbox", "roles":"outbox-reply", "as-embed":true, "with-data":{
					"inReplyTo":"{{.Permalink}}"
				}},
				{"step": "set-header", "name":"hx-retarget", "value":"#replies"},
				{"step": "set-header", "name":"hx-reswap", "value":"innerHTML"},
				{"step":"view-html", "method":"post", "file":"replies"}
			]
		},

		"replies":{"step":"view-html"},
		"follow-button": {
			"roles":["self"],
			"step":"view-html"
		},
		"follow": {
			"roles":["self"],
			"steps":[
				{"step":"with-following", "steps":[
					{"step":"set-data", "from-url":["folderId", "url"], "values": {"collapseThreads": true}},
					{"step":"save"}
				]},
				{"step":"view-html", "method":"post", "file":"follow-button"}
			]
		},
		"unfollow": {
			"roles":["self"],
			"steps":[
				{"step":"with-following", "steps":[
					{"step":"delete"}
				]},
				{"step":"view-html", "method":"post", "file":"follow-button"},
				{"step":"remove-event", "event":"closeModal"}
			]
		},

		"delete": {
			"roles": ["self"],
			"steps": [
				{"step":"delete", "title":"Delete Message?", "message":"Are you sure you want to delete this message?"},
				{"step":"reload-page"}
			]
		}
	}
}	
