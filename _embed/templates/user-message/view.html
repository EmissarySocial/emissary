{{- $stream := .ActivityStream -}}

<div id="modal-header">

	<div>
		<div class="flex-row text-xs">

			<div style="flex-grow:1">
				<span class="button-group">
					<button id="previous" hx-get="/@me/messages/{{.MessageID}}/view?sibling=prev&followingId={{.QueryParam `origin.followingId`}}">&laquo; Prev</button>
					<button id="next" hx-get="/@me/messages/{{.MessageID}}/view?sibling=next&followingId={{.QueryParam `origin.followingId`}}">Next &raquo;</button>
				</span>

				<span class="button-group">
					<button script="on click go to url '{{.OriginalURL}}' in new window">View Original</button>
					<button hx-get="/@me/following-edit?followingId={{.Origin.FollowingID.Hex}}">Edit Source</button>
					<button hx-get="/@me/messages/{{.MessageID}}/delete">Delete</button>
				</span>
			</div>

			<div class="align-right">
				<button script="on click send closeModal">Close</button>
			</div>
		
		</div>
	</div>

</div>

<div id="modal-body" script="install message(messageId:'{{.MessageID}}')">

	{{- if .Origin.NotEmpty -}}
	
		{{- if eq "DIRECT" .Origin.Type -}}

			<div>
				<a class="flex-row flex-align-center"
					href="/@me/inbox?folderId={{.FolderID}}&origin.followingId={{.Origin.FollowingID.Hex}}">
					
					{{- if eq "" .Origin.ImageURL -}}
						<div class="circle-48"></div>
					{{- else -}}
						<img src="{{.Origin.ImageURL}}" class="circle-48">
					{{- end -}}
					
					<div>
						<div class="text-plain text-lg bold margin-vertical-none">{{.Origin.Label}}</div>
						<div class="text-gray text-sm margin-vertical-none">{{.Origin.URL}}</div>
					</div>
				</a>
			</div>

		{{- else -}} 
		
			<div class="bold text-sm text-gray italics">
				{{- if eq "LIKE" .Origin.Type -}}
					{{icon "thumbs-up-fill"}} 
					<a class="text-gray" href="/@me/inbox/folderId={{.FolderID}}&origin.followingId={{.Origin.FollowingID.Hex}}">{{.Origin.Label}}</a> 
					Liked this
	
				{{- else if eq	"DISLIKE" .Origin.Type -}}
					{{icon "thumbs-down-fill"}} 
					<a class="text-gray" href="/@me/inbox/folderId={{.FolderID}}&origin.followingId={{.Origin.FollowingID.Hex}}">{{.Origin.Label}}</a>
					Disliked
		
				{{- else if eq "ANNOUNCE" .Origin.Type -}}
					{{icon "rocket-fill"}} 
					<a class="text-gray" href="/@me/inbox/folderId={{.FolderID}}&origin.followingId={{.Origin.FollowingID.Hex}}">{{.Origin.Label}}</a>
					Boosted this
		
				{{- else if eq "REPLY" .Origin.Type -}}
					{{icon "reply-fill"}} 
					<a class="text-gray" href="/@me/inbox/folderId={{.FolderID}}&origin.followingId={{.Origin.FollowingID.Hex}}">{{.Origin.Label}}</a>
					Replied to this

				{{- end -}}
			</div>

			{{- if $stream.AttributedTo.NotNil -}}
				<div>
					<a class="flex-row flex-align-center text-plain text-lg" href="{{.AttributedTo.ProfileURL}}">
						{{- if $stream.AttributedTo.Image.NotNil -}}
							<img src="{{$stream.AttributedTo.Image.URL}}" class="circle-48">
						{{- else -}}
							<div class="circle-48 inline-block"></div>
						{{- end -}}
						<div>
							<div class="text-plain text-lg bold margin-vertical-none">{{$stream.AttributedTo.Name}}</div>
							<div class="text-gray text-sm margin-vertical-none">{{$stream.AttributedTo.ID}}</div>
						</div>
					</a>
				</div>
			{{- end -}}

		{{- end -}}

	{{- end -}}
			
	{{- if ne "" $stream.Name -}}
		<h1 class="margin-vertical-lg"><a href="{{$stream.URL}}" target="_blank" class="text-black">{{$stream.Name}}</a></h1>
	{{- end -}}

	<div class="content margin-top margin-bottom">
		{{- $image := $stream.Image -}}
		{{- if $image.NotNil -}}
			<div class="margin-bottom">
				<a href="{{$stream.URL}}" target="_blank"><img src="{{$image.URL}}" style="width:100%;
				{{- if $image.HasDimensions}} aspect-ratio:{{$image.AspectRatio}};{{end}}"/></a>
			</div>
		{{- end -}}

		<div class="bold">{{ $stream.Published | longDate -}}</div>

		{{- if $stream.HasContent -}}
			<div>{{- $stream.Content | html -}}</div>
		{{- else if $stream.HasSummary -}}
			<div>{{- $stream.Summary -}}</div>
		{{- end -}}

	</div>

	<div id="replies" class="margin-bottom"> 

		{{- if eq $stream.Statistics.Replies 0 -}}
			<div class="bold margin-bottom">No Replies</div>
		{{- else -}}
			<hr>
			<div class="bold margin-bottom">
				{{- if eq 1 $stream.Statistics.Replies -}}
					1 Reply
				{{- else -}}
					{{$stream.Statistics.Replies}} Replies
				{{- end -}}
			</div>
			<div hx-get="/@me/messages/{{.MessageID}}/replies" 
				hx-target="this" 
				hx-push-url="false" 
				hx-trigger="htmx:afterProcessNode"
				hx-swap="outerHTML">
			</div>
		{{- end -}}
	</div>

</div>

<div id="modal-footer">
	{{.View "reply"}}
</div>